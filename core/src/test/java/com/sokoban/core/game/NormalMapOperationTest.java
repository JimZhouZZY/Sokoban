package com.sokoban.core.game;

import static org.testng.Assert.assertNotNull;
import static org.testng.Assert.assertTrue;
import java.io.File;
import java.util.List;
import org.testng.annotations.Test;

import com.sokoban.core.manager.JsonManager;

public class NormalMapOperationTest {

    /**
     * 测试地图是否正常读取
     */
    @Test
    public void testMapReading() {
        for (int i = 1; i <= 10; i++) {
            String mapFileName = "./test-files/test-level/normal/map" + i + ".cmap";

            List<MapTestCase> testCase = TestMapLoader.loadTestCases(new File(mapFileName));
            assertNotNull(testCase, "The map "  + mapFileName  + " should exists");

            // 检查第一个地图的读取内容
            // 如果结构有变，需要重新测试 Json
            if (i == 1) {
                String map1Json = "[{\"map\":[[\"----#-#--#-----------\",\"---#--------------#--\",\"-#--##########-------\",\"-#-##-@---#---##-----\",\"-####-----#----##-#--\",\"--#-##----##----#-#--\",\"#-#--####--###--#----\",\"--##---##----#--#----\",\"-#-######----#--#-#--\",\"--------######--#----\",\"--####--#------##-#--\",\"------#--######------\",\"---------------------\"],[\"----#-#--#-----------\",\"---#--------------#--\",\"-#--##########-------\",\"-#-##----@#---##-----\",\"-####-----#----##-#--\",\"--#-##----##----#-#--\",\"#-#--####--###--#----\",\"--##---##----#--#----\",\"-#-######----#--#-#--\",\"--------######--#----\",\"--####--#------##-#--\",\"------#--######------\",\"---------------------\"],[\"----#-#--#-----------\",\"---#--------------#--\",\"-#--##########-------\",\"-#-##-----#---##-----\",\"-####-----#----##-#--\",\"--#-##-@--##----#-#--\",\"#-#--####--###--#----\",\"--##---##----#--#----\",\"-#-######----#--#-#--\",\"--------######--#----\",\"--####--#------##-#--\",\"------#--######------\",\"---------------------\"],[\"----#-#--#-----------\",\"---#--------------#--\",\"-#--##########-------\",\"-#-##-----#---##-----\",\"-####-----#----##-#--\",\"--#-##----##----#-#--\",\"#-#--####-@###--#----\",\"--##---##----#--#----\",\"-#-######----#--#-#--\",\"--------######--#----\",\"--####--#------##-#--\",\"------#--######------\",\"---------------------\"],[\"----#-#--#-----------\",\"---#--------------#--\",\"-#--##########-------\",\"-#-##-----#---##-----\",\"-####-----#----##-#--\",\"--#-##@---##----#-#--\",\"#-#--####--###--#----\",\"--##---##----#--#----\",\"-#-######----#--#-#--\",\"--------######--#----\",\"--####--#------##-#--\",\"------#--######------\",\"---------------------\"]],\"moves\":[{\"dxs\":[0,0,0,1,1,1],\"dys\":[1,1,1,0,0,0]},{\"dxs\":[1,0,-1,-1,0,0,0,0],\"dys\":[0,1,0,0,-1,-1,-1,-1]},{\"dxs\":[-1,-1,-1,-1,1,1,1,1,1,1,1,0,1,1],\"dys\":[0,0,0,0,0,0,0,0,0,0,0,-1,0,0]},{\"dxs\":[0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,1,1,1,0,1,0,1,1,1,1,1,-1,-1,0,0,0,-1],\"dys\":[-1,-1,-1,-1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,-1,-1,-1,0]}]}]";
                assertTrue(new JsonManager().getJsonString(testCase).equals(map1Json), "map1.cmap's content can't match");
            }
        } 
    }
}
